<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lucia Docs</title>
    <script>
        if (localStorage.getItem('dark-mode') === '1') {
            document.documentElement.classList.add('dark');
        }
    </script>
    <link id="hljs-theme-light" rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" disabled>
    <link id="hljs-theme-dark" rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" disabled>
    <link rel="icon" type="image/png" href="../assets/logo_notext.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            font-family: Consolas, monospace, monospace;
            background: #fff;
            color: #111;
        }

        body.enable-transitions {
            transition: background 0.3s, color 0.3s;
        }

        body.enable-transitions pre code,
        body.enable-transitions pre,
        body.enable-transitions code {
            transition: background-color 0.3s, color 0.3s;
        }

        html.dark body {
            background: #121212;
            color: #ddd;
        }

        #page-header {
            background: #7356a5;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 1em;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        html.dark body #page-header {
            background: #4C3673;
        }

        #main-layout {
            flex: 1;
            display: flex;
            overflow: visible;
        }

        #sidebar {
            width: 250px;
            overflow-y: auto;
            border-right: 1px solid #ccc;
            background: #f7f7f7;
            padding: 1em;
            box-sizing: border-box;
            transition: background 0.3s, color 0.3s;
            position: sticky;
            top: 3.5rem;
            height: calc(100vh - 3rem);
            flex-shrink: 0;
            z-index: 500;
        }

        #sidebar.closed {
            transform: translateX(-100%);
        }


        html.dark body #sidebar {
            background: #1e1e1e;
            border-color: #444;
        }

        #content {
            flex: 1;
            overflow-y: auto;
            padding: 1em 2em;
            max-width: 900px;
            margin: auto;
            box-sizing: border-box;
        }

        .toc-list {
            list-style: none;
            padding-left: 0.5em;
            margin-left: 0;
        }

        .toc-list li {
            margin: 0.2em 0;
            cursor: pointer;
            user-select: none;
        }

        .toc-list li>ul {
            margin-left: 1em;
            border-left: 1px solid #ccc;
            padding-left: 0.5em;
            display: none;
        }

        html.dark body .toc-list li>ul {
            border-color: #555;
        }

        .toc-list li.expanded>ul {
            display: block;
        }

        .toc-toggle {
            margin-right: 0.3em;
            color: #007acc;
            user-select: none;
        }

        html.dark body .toc-toggle {
            color: #0a84ff;
        }

        .toc-link {
            color: inherit;
            text-decoration: none;
        }

        .toc-link:hover {
            text-decoration: underline;
        }

        #content h1,
        #content h2,
        #content h3 {
            scroll-margin-top: 80px;
        }

        #content a {
            color: #007acc;
            text-decoration: none;
        }

        html.dark body #content a {
            color: #0a84ff;
        }

        #content a:hover {
            text-decoration: underline;
        }

        pre {
            display: hidden;
        }

        code {
            background: #eee;
            padding: 0px 2px;
            border-radius: 4px;
            font-family: Consolas, monospace;
        }

        .hljs {
            background: #eee;
        }

        html.dark code {
            background: #222;
        }

        #dark-toggle {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.3em;
            user-select: none;
        }

        #dark-toggle:focus {
            outline: 2px solid white;
        }

        footer {
            background: #7356a5;
            color: white;
            padding: 1em 2em;
            font-size: 0.9rem;
            user-select: none;
            display: flex;
            justify-content: center;
            gap: 2em;
            flex-shrink: 0;
        }

        html.dark body footer {
            background: #4C3673;
        }

        footer a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.4em;
        }

        footer a:hover {
            text-decoration: underline;
        }

        .hljs-variable {
            color: #6f42c1;
        }
        .hljs-operator {
            color: #d73a49;
        }
        .hljs-meta {
            color: #005cc5;
        }

        html.dark body .hljs-variable {
            color: #8be9fd;
        }
        html.dark body .hljs-operator {
            color: #ff79c6;
        }
        html.dark body .hljs-meta {
            color: #3883da;
        }

        .hljs-comment {
            color: #6a737d;
            font-style: italic;
        }

        html {
            scrollbar-color: #888 transparent;
            scrollbar-width: medium;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 4px;
            background-color: #fff;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #888;
            border-radius: 6px;
            border: 2px solid #fff;
        }

        html.dark {
            scrollbar-color: #555 transparent;
        }

        html.dark ::-webkit-scrollbar {
            background-color: #121212;
        }

        html.dark ::-webkit-scrollbar-thumb {
            background-color: #555;
            border: 2px solid #121212;
        }

        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation: none !important;
                transition: none !important;
                scroll-behavior: auto !important;
            }
        }

        #burger {
        position: relative;
        font-size: 2rem;
        cursor: pointer;
        z-index: 1000;
        }

        @media (max-width: 768px) {
            #burger {
                display: block;
            }

            #sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                z-index: 999;
                background: #f0f0f0;
                box-shadow: 2px 0 5px rgba(0,0,0,0.3);
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                padding-top: 4rem !important;
            }

            #sidebar.open {
                transform: translateX(0);
            }

            #content {
                flex: 1;
                margin-left: 0;
            }
        }

        @media (min-width: 769px) {
            #burger {
                display: none;
            }
        }

        @media (max-width: 600px) {
            body {
                font-size: 14px;
            }
            #sidebar {
                width: 180px;
                padding: 0.5em;
                font-size: 0.85rem;
            }
            #content {
                padding: 0.5em 1em;
                max-width: 100%;
                font-size: 0.9rem;
            }
            #page-header {
                font-size: 1.2rem;
                padding: 0.5em 1em;
            }
            footer {
                font-size: 0.8rem;
                padding: 0.5em 1em;
                flex-direction: column;
                gap: 1em;
            }
            #dark-toggle {
                font-size: 1rem;
            }
        }
    </style>
</head>

<body>
    <header id="page-header">
        <span id="header-title">Loading...</span>
        <div id="burger" aria-label="Toggle sidebar" role="button" tabindex="0">
            <i class="bi bi-list"></i>
        </div>
        <button id="dark-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
            <i class="bi bi-moon-fill" id="dark-icon"></i><span> Dark Mode</span>
        </button>
    </header>

    <div id="main-layout">
        <nav id="sidebar">
            <h3>Contents</h3>
            <ul id="toc" class="toc-list"></ul>
        </nav>
        <main id="content">Loading content...</main>
    </div>

    <footer>
        <a href="https://github.com/SirPigari/lucia-rust" target="_blank" rel="noopener">
            <i class="bi bi-github"></i> Lucia Rust
        </a>
        <a href="https://github.com/SirPigari/lym" target="_blank" rel="noopener">
            <i class="bi bi-github"></i> Lym - package manager
        </a>
        <a href="https://github.com/SirPigari/lucia" target="_blank" rel="noopener">
            <i class="bi bi-github"></i> Lucia Python
        </a>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>
    <script>
        const headerTitle = document.getElementById('header-title');
        const contentEl = document.getElementById('content');
        const tocEl = document.getElementById('toc');
        const darkToggleBtn = document.getElementById('dark-toggle');
        const darkIcon = document.getElementById('dark-icon');

        hljs.registerLanguage('lucia', function (hljs) {
            const KEYWORDS = 'fun return throw end catch try static non-static public private final mutable if else then for while as from import in forget and or not isnt is xor xnor nein match break continue defer scope pass band lshift rshift bor bnot type where true false null void any int float bool str map list function bytes tuple auto';

            return {
                name: 'lucia',
                keywords: {
                    keyword: KEYWORDS.split(' ').join(' '),
                },
                contains: [
                    hljs.C_LINE_COMMENT_MODE,
                    hljs.C_BLOCK_COMMENT_MODE,
                    {
                        className: 'comment',
                        begin: '<#', end: '#>'
                    },
                    {
                        className: 'meta',
                        match: /^\s*#\w+/
                    },
                    {
                        className: 'string',
                        variants: [
                            { begin: /[frbFRB]{0,3}'''/, end: /'''/, contains: [hljs.BACKSLASH_ESCAPE] },
                            { begin: /[frbFRB]{0,3}"""/, end: /"""/, contains: [hljs.BACKSLASH_ESCAPE] },
                            { begin: /r"/i, end: /"/ },
                            { begin: /r'/i, end: /'/ },
                            { begin: /[fbFB]{0,2}"/, end: /"/, contains: [hljs.BACKSLASH_ESCAPE] },
                            { begin: /[fbFB]{0,2}'/, end: /'/, contains: [hljs.BACKSLASH_ESCAPE] }
                        ]
                    },
                    hljs.NUMBER_MODE,
                    {
                        className: 'function',
                        beginKeywords: 'fun',
                        end: /[{;]/,
                        excludeEnd: true,
                        contains: [hljs.UNDERSCORE_TITLE_MODE]
                    },
                    {
                        className: 'title',
                        begin: /\b[a-zA-Z_][a-zA-Z0-9_]*\s*(?=\()/
                    },
                    {
                        className: 'macro',
                        begin: /\b[a-zA-Z_][a-zA-Z0-9_]*!\s*(?=[({])/,
                        end: /[\)}]/,
                        returnBegin: true,
                        contains: [
                            {
                                className: 'title',
                                begin: /\b[a-zA-Z_][a-zA-Z0-9_]*!/
                            }
                        ]
                    },
                    {
                        className: 'type',
                        begin: /\b[A-Z][a-zA-Z0-9_]*\b/
                    },
                    {
                        className: 'operator',
                        match: /(->|>=|<=|==|!=|\+=|-=|\*=|\/=|=|<<|>>|\+\+|--|\+|-|\^|\*|\/|>|<|!|%|\|\||&&|\||#|~|\$|\?|&|\^=|%=|\.\.\.|\.{2}|[(){}\[\];:.,\?])/
                    },
                    {
                        // variables: match all valid identifiers BUT not keywords
                        className: 'variable',
                        match: /\b[a-zA-Z_][a-zA-Z0-9_]*\b/,
                        keywords: {
                            // exclude keywords here from being matched as variable
                            // hljs uses this to remove keywords from this match
                            keyword: KEYWORDS
                        }
                    }
                ]
            };
        });

        function getFileParam() {
            const params = new URLSearchParams(window.location.search);
            return params.get('file');
        }

        async function fetchMD(url) {
            try {
                const res = await fetch(url);
                if (!res.ok) return null;
                return await res.text();
            } catch {
                return null;
            }
        }

        function buildTOCList() {
            const files = [
                { path: 'https://raw.githubusercontent.com/SirPigari/lucia-rust/main/README.md', title: 'Home' },
                { path: 'https://raw.githubusercontent.com/SirPigari/lucia-rust/main/src/env/Docs/getting-started.md', title: 'Getting started' },
                { path: 'https://raw.githubusercontent.com/SirPigari/lucia-rust/main/src/env/Docs/installation-guide.md', title: 'Installation guide' },
                { path: 'https://raw.githubusercontent.com/SirPigari/lucia-rust/main/src/env/Docs/config-guide.md', title: 'Config guide' },
                { path: 'https://raw.githubusercontent.com/SirPigari/lucia-rust/main/src/env/Docs/language-syntax.md', title: 'Syntax' },
                { path: 'https://raw.githubusercontent.com/SirPigari/lucia-rust/main/src/env/Docs/standart-libs.md', title: 'Standard libraries API' },
                { path: 'https://raw.githubusercontent.com/SirPigari/lucia-rust/main/src/env/Docs/versioning.md', title: 'Versioning' },
                { path: 'https://raw.githubusercontent.com/SirPigari/lucia-rust/main/src/env/Docs/contributing.md', title: 'Contributing guide' },
                { path: 'https://raw.githubusercontent.com/SirPigari/lucia-rust/main/src/env/Docs/changelog.md', title: 'Changelog' },
                { path: 'https://raw.githubusercontent.com/SirPigari/lucia-rust/main/src/env/Docs/known-issues.md', title: 'Known issues/bugs' }
            ];

            const selfHref = window.location.origin + window.location.pathname;

            const ul = document.createElement('ul');
            for (const file of files) {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `${selfHref}?file=${encodeURIComponent(file.path)}`;
                a.textContent = file.title;
                a.classList.add('toc-link');
                li.appendChild(a);
                ul.appendChild(li);
            }
            return ul;
        }

        function updateDarkModeUI(isDark) {
            const light = document.getElementById('hljs-theme-light');
            const dark = document.getElementById('hljs-theme-dark');
            light.disabled = isDark;
            dark.disabled = !isDark;

            if (isDark) {
                document.documentElement.classList.add('dark');
                darkIcon.className = 'bi bi-sun-fill';
                darkToggleBtn.textContent = ' Light Mode';
                darkToggleBtn.prepend(darkIcon);
            } else {
                document.documentElement.classList.remove('dark');
                darkIcon.className = 'bi bi-moon-fill';
                darkToggleBtn.textContent = ' Dark Mode';
                darkToggleBtn.prepend(darkIcon);
            }
        }

        darkToggleBtn.onclick = () => {
            const htmlEl = document.documentElement;
            const isDark = htmlEl.classList.toggle('dark');
            localStorage.setItem('dark-mode', isDark ? '1' : '0');
            updateDarkModeUI(isDark);
        };

        const isDarkMode = localStorage.getItem('dark-mode') === '1';
        if (isDarkMode) {
            document.body.classList.add('dark');
        }
        updateDarkModeUI(isDarkMode);

        requestAnimationFrame(() => {
            document.body.classList.add('enable-transitions');
        });

        function fixRelativeLinks(baseUrl) {
            const base = new URL(baseUrl);
            const selfBase = window.location.pathname;

            document.querySelectorAll('img[src], a[href]').forEach(el => {
                const isImg = el.tagName.toLowerCase() === 'img';
                const attr = isImg ? 'src' : 'href';
                const val = el.getAttribute(attr);

                if (!val) return;

                if (
                    val.startsWith('http://') ||
                    val.startsWith('https://') ||
                    val.startsWith('file://') ||
                    val.startsWith('//') ||
                    val.startsWith('#')
                ) return;

                try {
                    const abs = new URL(val, base);

                    if (!isImg && abs.pathname.endsWith('.md')) {
                        const redirectUrl = `${selfBase}?file=${encodeURIComponent(abs.href)}`;
                        el.setAttribute('href', redirectUrl);
                    } else if (
                        !isImg &&
                        base.hostname === 'raw.githubusercontent.com' &&
                        !/\.[a-z0-9]+$/i.test(abs.pathname)
                    ) {
                        const parts = abs.pathname.split('/').filter(Boolean);
                        if (parts.length >= 3) {
                            const [user, repo, branch, ...path] = parts;
                            const githubUrl = `https://github.com/${user}/${repo}/tree/${branch}/${path.join('/')}`;
                            el.setAttribute('href', githubUrl);
                        }
                    } else {
                        el.setAttribute(attr, abs.href);
                    }
                } catch (_) { }
            });
        }

        async function main() {
            const file = getFileParam();
            if (!file) {
                const defaultFile = 'https://raw.githubusercontent.com/SirPigari/lucia-rust/main/README.md';
                const currentUrl = new URL(window.location.href);
                currentUrl.search = `?file=${encodeURIComponent(defaultFile)}`;
                window.location.href = currentUrl.toString();
                return;
            }

            headerTitle.textContent = `Loading ${file}...`;
            const md = await fetchMD(file);
            if (!md) {
                headerTitle.textContent = 'Failed to load file';

                contentEl.textContent = '';

                const link = document.createElement('a');
                link.href = file;
                link.textContent = file;
                link.style.textDecoration = 'none';
                link.style.color = 'inherit';
                link.target = '_blank';
                link.rel = 'noopener noreferrer';

                link.addEventListener('mouseover', () => {
                    link.style.textDecoration = 'underline';
                });
                link.addEventListener('mouseout', () => {
                    link.style.textDecoration = 'none';
                });

                contentEl.appendChild(document.createTextNode('Could not fetch "'));
                contentEl.appendChild(link);
                contentEl.appendChild(document.createTextNode('"'));

                return;
            }

            headerTitle.textContent = `Lucia Docs - ${file.split('/').pop()}`;

            marked.setOptions({
                gfm: true,
                breaks: false,
                smartLists: true,
                smartypants: false,
                headerIds: true,
                mangle: false,
                sanitize: false,
                highlight: function (code, lang) {
                    if (lang && hljs.getLanguage(lang)) {
                        return hljs.highlight(code, { language: lang }).value;
                    }
                    return hljs.highlightAuto(code).value;
                }
            });

            contentEl.innerHTML = marked.parse(md);

            fixRelativeLinks(file);
            hljs.highlightAll();
        }

        const tocContainer = document.getElementById('toc');
        if (tocContainer) {
            const tocList = buildTOCList();
            tocContainer.replaceWith(tocList);
            tocList.id = 'toc';
            tocList.className = 'toc-list';
        }

        main();
    </script>
    <script>
        const burger = document.getElementById('burger');
        const sidebar = document.getElementById('sidebar');

        function toggleSidebar() {
            sidebar.classList.toggle('open');
            sidebar.classList.toggle('closed');
        }

        burger.addEventListener('click', toggleSidebar);
        burger.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                toggleSidebar();
            }
        });
    </script>
</body>

</html>